<div class="app-wrapper">
  <header class="header">
    <div class="header-left">
      <img src="assets/home-icon.png" class="logo" alt="Logo" />
    </div>

    @if (userState$ | async; as usuario) {
    @if (hogar$ | async; as hogar) {

    <div class="header-center">
      <button class="hogar-titulo" type="button" (click)="abrirInvitar(hogar)">
        ğŸ  {{ hogar.nombre }}
      </button>

      @if (isAdmin$ | async) {
      <span class="admin-badge" aria-label="Administrador del hogar" title="Administrador">
        <span class="badge-ico">ğŸ‘‘</span>
        Admin
        <span class="shimmer" aria-hidden="true"></span>
      </span>
      }
    </div>

    } @else {

    @if ((hogar$ | async) === null) {
    <div class="header-center sin-hogar-botones">
      <button class="boton-hogar crear" type="button" (click)="abrirCrearHogar()">
        Crear hogar
      </button>
      <button class="boton-hogar unirse" type="button" (click)="abrirUnirme()">
        Unirme
      </button>
    </div>
    } @else {
    <div class="header-center">
      <span class="hogar-titulo demo" style="opacity:0">Cargandoâ€¦</span>
    </div>
    }

    }

    } @else {

    @if ((userState$ | async) === null) {
    <div class="header-center">
      <span class="hogar-titulo demo">ğŸ  Demo Hogar</span>
    </div>
    } @else {
    <div class="header-center">
      <span class="hogar-titulo demo" style="opacity:0">Cargandoâ€¦</span>
    </div>
    }
    }

    <div class="header-right">
      @if (userState$ | async; as u) {
      @if (usuarioCompleto$ | async; as usuario) {
      <div class="user-info">
        <button class="tienda-trigger" matTooltip="Canjear puntos" type="button"
          (click)="abrirTienda(usuario, hogarActual)" [class.tienda-con-puntos]="(usuario?.puntos ?? 0) > 0">
          <div class="puntos-usuario-wrapper">
            <div class="puntos-usuario" [ngClass]="{
                'positivo': (usuario?.puntos ?? 0) >= 0,
                'negativo': (usuario?.puntos ?? 0) < 0,
                'puntos-flash': ultimoCanjeoOk
              }">
              {{ puntosAnimados }}
            </div>

            <img src="assets/coin.png" alt="Moneda" class="moneda-animada" />

            <div class="confetti" *ngIf="mostrarConfetti">
              <span class="confetti-piece" *ngFor="let p of confettiPieces; let i = index"></span>
            </div>
          </div>

          <span class="tienda-icon">ğŸ›’</span>
          <span class="tienda-text">Tienda</span>
        </button>

        <img class="avatar" [src]="usuario?.photoURL || 'assets/default-avatar.png'" (error)="onImageError($event)"
          [alt]="usuario?.nombre" />

        <button class="btn-google" (click)="auth.logout()">
          Cerrar sesiÃ³n ({{ usuario.nombre || usuario.email }})
        </button>
      </div>
      } @else {
      <!-- Usuario logueado pero perfil aÃºn cargando: placeholder -->
      <div class="user-info">
        <button class="tienda-trigger" type="button" disabled style="opacity:0">
          <span class="tienda-icon">ğŸ›’</span>
          <span class="tienda-text">Tienda</span>
        </button>
        <button class="btn-google" type="button" disabled style="opacity:0">
          Cargandoâ€¦
        </button>
      </div>
      }

      } @else {

      @if ((userState$ | async) === null) {
      <!-- No logueado: demo + login -->
      <div class="user-info">
        <button class="tienda-trigger" matTooltip="Vista previa de la tienda" type="button" (click)="abrirTiendaDemo()">
          <div class="puntos-usuario-wrapper">
            <div class="puntos-usuario positivo">120</div>
            <img src="assets/coin.png" alt="Moneda" class="moneda-animada" />
          </div>

          <span class="tienda-icon">ğŸ›’</span>
          <span class="tienda-text">Tienda (demo)</span>
        </button>

        <button class="btn-google" (click)="auth.loginGoogle()">
          <img src="assets/google-icon.png" class="google-icon" alt="Google" />
          Iniciar sesiÃ³n con Google
        </button>
      </div>
      } @else {
      <!-- Auth cargando: NO mostrar demo ni login -->
      <div class="user-info">
        <button class="tienda-trigger" type="button" disabled style="opacity:0">
          <span class="tienda-icon">ğŸ›’</span>
          <span class="tienda-text">Tienda</span>
        </button>

        <button class="btn-google" type="button" disabled style="opacity:0">
          Iniciar sesiÃ³n con Google
        </button>
      </div>
      }
      }

    </div>
  </header>

  <main class="contenido-principal">
    <app-lista-tareas></app-lista-tareas>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <span>ğŸ§˜ ZenHogar â€” La armonÃ­a empieza en casa</span>
      <span>v1.0</span>

      <a href="https://instagram.com/appZenHogar" target="_blank" rel="noopener noreferrer" class="instagram-link">
        <img src="assets/instagram.png" alt="Instagram" class="instagram-icon">
      </a>
    </div>
  </footer>
</div>