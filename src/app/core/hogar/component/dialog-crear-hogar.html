<div class="dialog-container">
  <h1 class="titulo-modal">
    <mat-icon>home</mat-icon> Crear hogar
  </h1>

  <button type="button" class="pais-detector" [matMenuTriggerFor]="menuPaises" aria-label="Cambiar país">
    <img class="bandera" [src]="'assets/flags/' + countryCode.toLowerCase() + '.svg'" [alt]="countryCode + ' flag'" />
    <span class="codigo">{{ countryCode }}</span>
    <mat-icon>expand_more</mat-icon>
  </button>

  <mat-menu #menuPaises="matMenu" class="menu-paises">
    @for (code of paisesDisponibles; track code) {
    <button mat-menu-item (click)="seleccionarPais(code)">
      <img matMenuItemIcon class="bandera" [src]="flagPath(code)" [alt]="countryName(code) + ' flag'" width="20"
        height="14" />
      <span class="nombre-pais">{{ countryName(code) }}</span>
    </button>
    }
  </mat-menu>

  <form #f="ngForm" (ngSubmit)="crear()" class="dialog-body">
    <mat-form-field appearance="outline" class="w-100">
      <mat-label>Nombre del hogar</mat-label>
      <input matInput [(ngModel)]="nombre" name="nombre" required autocomplete="off" />
      @if (f.submitted && !nombre) {
      <mat-error>El nombre es obligatorio</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100 tipo-hogar-field">
      <mat-label>Tipo de hogar</mat-label>

      <mat-select [(ngModel)]="tipoHogar" name="tipoHogar" required [disableOptionCentering]="true"
        [panelClass]="'select-panel-pro'">
        <mat-select-trigger>
          {{ tipoHogar || 'Elige una opción…' }}
        </mat-select-trigger>

        @for (tipo of tiposHogar; track tipo) {
        <mat-option [value]="tipo">{{ tipo }}</mat-option>
        }
      </mat-select>

      @if (f.submitted && !tipoHogar) {
      <mat-error>Elige un tipo de hogar</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-100">
      <mat-label>Provincia</mat-label>

      <input matInput placeholder="Escribe y elige..." [(ngModel)]="provinciaInput" name="provinciaInput" required
        (ngModelChange)="onProvinciaInputChange($event)" [matAutocomplete]="auto"
        (keydown.enter)="onProvinciaEnter($any($event))" autocomplete="off" role="combobox" aria-autocomplete="list"
        aria-expanded="true" />

      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onProvinciaSelected($event.option.value)"
        autoActiveFirstOption class="panel-provincias">
        @for (p of provinciasFiltradas; track p.code) {
        <mat-option [value]="p.name">{{ p.name }}</mat-option>
        }
        @if (provinciasFiltradas.length === 0) {
        <mat-option disabled>Sin resultados</mat-option>
        }
      </mat-autocomplete>

      <mat-hint>Usaremos la provincia para rankings y vistas locales</mat-hint>
      @if (f.submitted && !provinciaValida) {
      <mat-error>Elige una provincia válida</mat-error>
      }
    </mat-form-field>

    <div mat-dialog-actions>
      <button mat-button type="button" (click)="cancelar()">Cancelar</button>
      <button mat-flat-button type="submit" color="primary" [disabled]="f.invalid || !provinciaValida || !tipoHogar">
        Crear
      </button>
    </div>
  </form>
</div>
