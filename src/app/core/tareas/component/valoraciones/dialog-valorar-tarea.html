<div class="dialog-container">
  <button type="button" class="close-fab" mat-icon-button aria-label="Cerrar" (click)="cerrarDialogo()">
    <mat-icon fontIcon="close"></mat-icon>
  </button>

  <h1 class="titulo-modal">
    <span class="icon-wrapper">
      <mat-icon>star_rate</mat-icon>
    </span>
    <span>Valorar tarea</span>
  </h1>

  @if (data['nombreTarea']) {
  <p class="subtitulo-tarea">
    Â¿CÃ³mo se ha realizado <strong>{{ data['nombreTarea'] }}</strong>?
  </p>
  } @else {
  <p class="subtitulo-tarea">
    CuÃ©ntanos quÃ© tal se ha hecho esta tarea.
  </p>
  }

  @if (isDemoMode) {
  <div class="aviso-demo">
    ðŸ‘€ EstÃ¡s en modo demo â€” la valoraciÃ³n no se guardarÃ¡ realmente.
  </div>
  }

  <form #form="ngForm" (ngSubmit)="guardarValoracion()" class="dialog-body">

    <div class="valoracion-bloque">
      <div class="texto-valoracion">
        @if (valorSeleccionado === 0) {
        <span class="muted">Elige una puntuaciÃ³n de 1 a 5 estrellas</span>
        } @else {
        <span class="etiqueta-activa">
          {{ estrellas[valorSeleccionado - 1].etiqueta }}
        </span>
        }
      </div>

      <div class="valoracion-estrellas">
        <ng-container *ngFor="let estrella of estrellas">
          <button mat-icon-button type="button" (click)="seleccionarEstrella(estrella.valor)"
            [class.seleccionada]="estrella.valor <= valorSeleccionado" matTooltip="{{ estrella.etiqueta }}">
            <mat-icon>star</mat-icon>
          </button>
        </ng-container>
      </div>
    </div>

    <details class="puntos-details">
      <summary>
        <mat-icon class="sum-ico">help_outline</mat-icon>
        <span>Â¿CÃ³mo se puntÃºa?</span>
        <span class="sum-spacer"></span>
        <span class="sum-hint">Ver</span>
      </summary>

      <div class="puntos-body">
        <p>
          Cuando <b>todos</b> valoran, calculamos la <b>media</b> de estrellas y la <b>redondeamos</b>.
          Esa puntuaciÃ³n se convierte en puntos y se suma a <b>quien realizÃ³ la tarea</b>.
        </p>

        <div class="formula">
          <span>Puntos</span>
          <span>=</span>
          <span>base(â˜…)</span>
          <span>Ã—</span>
          <span>dificultad</span>
        </div>

        <p class="ej">
          Ejemplo: media <b>4â˜…</b> â†’ base <b>+5</b> â†’ con dificultad <b>x2</b> = <b>+10</b>.
        </p>

        <details class="equiv-details">
          <summary>
            <span class="eq-toggle">Ver equivalencias de estrellas</span>
            <span class="eq-spacer"></span>
            <span class="eq-hint">5â˜…â€¦1â˜…</span>
          </summary>

          <p class="equivalencias">
            5â˜… = +10 | 4â˜… = +5 | 3â˜… = +2 | 2â˜… = âˆ’5 | 1â˜… = âˆ’10
          </p>
        </details>
      </div>
    </details>

    <mat-form-field appearance="outline">
      <mat-label>Comentario (opcional)</mat-label>
      <textarea matInput name="comentario" [(ngModel)]="comentario" rows="3"
        placeholder="Â¿Algo que destacar? Ej: â€˜Ha quedado impecableâ€™ o â€˜PodrÃ­a haberse hecho mejorâ€™â€¦"></textarea>
    </mat-form-field>

    <div mat-dialog-actions class="acciones-dialogo">
      <button mat-button type="button" (click)="cerrarDialogo()">
        Cancelar
      </button>
      <button mat-flat-button color="primary" type="submit" [disabled]="valorSeleccionado === 0" class="btn-guardar">
        Guardar valoraciÃ³n
      </button>
    </div>
  </form>
</div>